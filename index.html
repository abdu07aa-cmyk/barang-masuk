<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Report Barang Masuk</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{font-family:Arial;padding:10px;background:#f4f6f8}
input,select,button{padding:6px;margin:4px;width:100%}
table{width:100%;border-collapse:collapse;margin-top:10px;background:#fff}
th,td{border:1px solid #ccc;padding:6px;text-align:center;font-size:12px}
th{background:#eaeaea}
.btn{background:#007bff;color:#fff;border:none;border-radius:4px}
.btn-red{background:#dc3545;color:#fff;border:none;border-radius:4px}
.btn-green{background:#28a745;color:#fff;border:none;border-radius:4px}
</style>
</head>

<body>

<h3>Report Barang Masuk</h3>

<label>Tanggal</label>
<input type="date" id="tanggal">

<label>Nama Brand</label>
<input type="text" id="brand" placeholder="Nama Brand">

<h4>Detail Barang Masuk</h4>
<table id="inputTable">
<tr>
<th>Jenis</th>
<th>Paper</th>
<th>Size</th>
<th>Barang Masuk</th>
<th>Aksi</th>
</tr>
</table>

<button class="btn" onclick="tambahBaris()">+ Tambah Barang</button>
<button class="btn" onclick="simpanData()">Simpan</button>
<button class="btn-green" onclick="exportExcel()">Export Excel</button>
<button class="btn-green" onclick="kirimWAGroup()">Kirim ke WA Group</button>
<a href="https://chat.whatsapp.com/JxuBOcHA8BxA4rWoiWA05o" target="_blank">
Gabung Grup WhatsApp
</a>

<h3>Data Barang Masuk</h3>
<table id="dataTable">
<tr>
<th>Tanggal</th>
<th>Brand</th>
<th>Jenis</th>
<th>Paper</th>
<th>Size</th>
<th>Barang Masuk</th>
<th>Aksi</th>
</tr>
</table>
<script>
// Daftar pilihan
const jenisList = ["BOOKLET","FILTER WHITE","FILTER BROWN","DISPLAY","PLAT","MAGNET","DOUBLE TAPE","COVER","PAPER","MIKA","STICKER MIKA","STICKER BULAT BESAR","STICKER BULAT KECIL","TUBE","FILTER 21","FILTER 26","FILTER 30","HOLDER S","HOLDER M","HOLDER L","HOLDER 9X9","HOLDER 10X10"];
const sizeList  = ["1 1/4","SINGLE","KS","KSS","KSSS","SKS","3 CONES/PACK","6 CONES/PACK","700 CONES/BOX","729 CONES/BOX","900 CONES/BOX","800 CONES/BOX","1000 CONES/BOX"];
const paperList = ["32 LEAVES","33 LEAVES","35 LEAVES","40 LEAVES","42 LEAVES","50 LEAVES","51 LEAVES","52 LEAVES","60 LEAVES","70 MM","83 MM","84 MM","98 MM","109 MM"];

let lastValue={};

function tambahBaris(){
 const table=document.getElementById("inputTable");
 const row=table.insertRow(-1);

 row.innerHTML=`
 <td><select>${opt(jenisList,lastValue.jenis)}</select></td>
 <td><select>${opt(paperList,lastValue.paper)}</select></td>
 <td><select>${opt(sizeList,lastValue.size)}</select></td>
 <td><input type="number" value="${lastValue.qty||""}"></td>
 <td><button class="btn-red" onclick="this.parentElement.parentElement.remove()">Hapus</button></td>
 `;
}

function opt(list,selected){
 return <option value="">-- pilih --</option>+
 list.map(v=><option ${v==selected?"selected":""}>${v}</option>).join("");
}

function simpanData(){
 const tanggal=document.getElementById("tanggal").value;
 const brand=document.getElementById("brand").value;
 const rows=document.querySelectorAll("#inputTable tr");

 if(!tanggal||!brand){
   alert("Tanggal & Brand wajib");
   return;
 }

 for(let i=1;i<rows.length;i++){
   const e=rows[i].querySelectorAll("select,input");
   if(!e[0].value)continue;

   lastValue={
     jenis:e[0].value,
     paper:e[1].value,
     size:e[2].value,
     qty:e[3].value
   };

   document.getElementById("dataTable").insertRow(-1).innerHTML=`
   <td>${tanggal}</td>
   <td>${brand}</td>
   <td>${e[0].value}</td>
   <td>${e[1].value}</td>
   <td>${e[2].value}</td>
   <td>${e[3].value}</td>
   <td><button class="btn-red" onclick="this.parentElement.parentElement.remove()">Hapus</button></td>`;
 }

 document.getElementById("inputTable").innerHTML=`
 <tr>
 <th>Jenis</th>
 <th>Paper</th>
 <th>Size</th>
 <th>Barang Masuk</th>
 <th>Aksi</th>
 </tr>`;
}

function exportExcel(){
 let table=document.getElementById("dataTable");
 if(table.rows.length<=1){
   alert("Data kosong");
   return;
 }

 let data=[];
 for(let i=1;i<table.rows.length;i++){
  let r=table.rows[i];
  data.push([
    r.cells[0].innerText,
    r.cells[1].innerText,
    r.cells[2].innerText,
    r.cells[3].innerText,
    r.cells[4].innerText,
    r.cells[5].innerText
  ]);
 }

 let wb = XLSX.utils.book_new();
 let ws = XLSX.utils.aoa_to_sheet([
   ["Tanggal","Brand","Jenis","Paper","Size","Barang Masuk"],
   ...data
 ]);

 XLSX.utils.book_append_sheet(wb, ws, "Barang Masuk");
 XLSX.writeFile(wb, "Report_Barang_Masuk.xlsx");
}

function kirimWAGroup(){
 const table = document.getElementById("dataTable");
 const rows  = table.querySelectorAll("tr");

 if(rows.length<=1){
   alert("Data barang masuk masih kosong");
   return;
 }

 let hasil = {};

 for(let i=1;i<rows.length;i++){
   let c = rows[i].cells;
   let tanggal = c[0].innerText;
   let brand   = c[1].innerText;
   let detail  = â€¢ ${c[2].innerText} | ${c[3].innerText} | ${c[4].innerText} | Qty ${c[5].innerText};

   if(!hasil[brand]){
     hasil[brand] = { tanggal, list: [] };
   }
   hasil[brand].list.push(detail);
 }

 let pesan = "";
 for(let brand in hasil){
   pesan +=
`ðŸ“¦ REPORT BARANG MASUK
ðŸ“… ${hasil[brand].tanggal}
ðŸ·ï¸ Brand: ${brand}

${hasil[brand].list.join("%0A")}

--------------------
`;
 }

 let linkWA = "https://api.whatsapp.com/send?text=" + encodeURIComponent(pesan);
 window.open(linkWA, "_blank");
}

</script>
</body>
</html>

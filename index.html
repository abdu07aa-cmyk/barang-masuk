<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Report Barang Masuk</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{font-family:Arial;padding:10px;background:#f4f6f8}
input,select,button{padding:6px;margin:4px;width:100%}
table{width:100%;border-collapse:collapse;margin-top:10px;background:#fff}
th,td{border:1px solid #ccc;padding:6px;text-align:center;font-size:12px}
th{background:#eaeaea}
.btn{background:#007bff;color:#fff;border:none;border-radius:4px}
.btn-red{background:#dc3545;color:#fff;border:none;border-radius:4px}
.btn-green{background:#28a745;color:#fff;border:none;border-radius:4px}
</style>
</head>

<body>

<h3>Report Barang Masuk</h3>

<label>Tanggal</label>
<input type="date" id="tanggal">

<label>Nama Brand</label>
<input type="text" id="brand" placeholder="Nama Brand">

<h4>Detail Barang Masuk</h4>
<table id="inputTable">
<tr>
<th>Jenis</th>
<th>Paper</th>
<th>Size</th>
<th>Barang Masuk</th>
<th>Aksi</th>
</tr>
</table>

<button class="btn" onclick="tambahBaris()">+ Tambah Barang</button>
<button class="btn" onclick="simpanData()">Simpan</button>
<button class="btn-green" onclick="exportExcel()">Export Excel</button>
<button class="btn-green" onclick="kirimWAGroup()">Kirim ke WA Group</button>

<h3>Data Barang Masuk</h3>
<table id="dataTable">
<tr>
<th>Tanggal</th>
<th>Brand</th>
<th>Jenis</th>
<th>Paper</th>
<th>Size</th>
<th>Barang Masuk</th>
<th>Aksi</th>
</tr>
</table>

<script type="text/javascript">
// ===== DATA LIST =====
const jenisList = ["BOOKLET","FILTER WHITE","FILTER BROWN","DISPLAY","PLAT","MAGNET","DOUBLE TAPE","COVER","PAPER","MIKA"];
const sizeList  = ["1 1/4","SINGLE","KS","KSS","KSSS","SKS"];
const paperList = ["32 LEAVES","33 LEAVES","35 LEAVES","40 LEAVES","50 LEAVES"];

let lastValue = {};

// ===== OPTION DROPDOWN =====
function opt(list, selected){
  return '<option value="">-- pilih --</option>' +
    list.map(v => `<option ${v===selected?'selected':''}>${v}</option>`).join("");
}

// ===== TAMBAH BARIS =====
function tambahBaris(){
 const table = document.getElementById("inputTable");
 const row = table.insertRow(-1);

 row.innerHTML = `
 <td><select>${opt(jenisList,lastValue.jenis)}</select></td>
 <td><select>${opt(paperList,lastValue.paper)}</select></td>
 <td><select>${opt(sizeList,lastValue.size)}</select></td>
 <td><input type="number" value="${lastValue.qty || ""}"></td>
 <td><button class="btn-red" onclick="this.closest('tr').remove()">Hapus</button></td>
 `;
}

// ===== SIMPAN DATA =====
function simpanData(){
 const tanggal = document.getElementById("tanggal").value;
 const brand   = document.getElementById("brand").value;
 const rows    = document.querySelectorAll("#inputTable tr");

 if(!tanggal || !brand){
   alert("Tanggal & Brand wajib");
   return;
 }

 for(let i=1;i<rows.length;i++){
   const e = rows[i].querySelectorAll("select,input");
   if(!e[0].value) continue;

   lastValue = {
     jenis:e[0].value,
     paper:e[1].value,
     size:e[2].value,
     qty:e[3].value
   };

   document.getElementById("dataTable").insertRow(-1).innerHTML = `
   <td>${tanggal}</td>
   <td>${brand}</td>
   <td>${e[0].value}</td>
   <td>${e[1].value}</td>
   <td>${e[2].value}</td>
   <td>${e[3].value}</td>
   <td><button class="btn-red" onclick="this.closest('tr').remove()">Hapus</button></td>`;
 }

 document.getElementById("inputTable").innerHTML = `
 <tr>
 <th>Jenis</th><th>Paper</th><th>Size</th><th>Barang Masuk</th><th>Aksi</th>
 </tr>`;
}

// ===== EXPORT EXCEL =====
function exportExcel(){
 let table=document.getElementById("dataTable");
 if(table.rows.length<=1){ alert("Data kosong"); return; }

 let data=[];
 for(let i=1;i<table.rows.length;i++){
  let r=table.rows[i];
  data.push([r.cells[0].innerText,r.cells[1].innerText,r.cells[2].innerText,
             r.cells[3].innerText,r.cells[4].innerText,r.cells[5].innerText]);
 }

 let wb=XLSX.utils.book_new();
 let ws=XLSX.utils.aoa_to_sheet([["Tanggal","Brand","Jenis","Paper","Size","Qty"],...data]);
 XLSX.utils.book_append_sheet(wb,ws,"Barang Masuk");
 XLSX.writeFile(wb,"Report_Barang_Masuk.xlsx");
}

// ===== KIRIM WHATSAPP (FIX) =====
function kirimWAGroup(){
 const rows=document.querySelectorAll("#dataTable tr");
 if(rows.length<=1){ alert("Data kosong"); return; }

 let pesan = "REPORT BARANG MASUK\n\n";
 for(let i=1;i<rows.length;i++){
   let c=rows[i].cells;
   pesan += `- ${c[1].innerText} | ${c[2].innerText} | ${c[3].innerText} | ${c[4].innerText} | Qty ${c[5].innerText}\n`;
 }

 window.open("https://api.whatsapp.com/send?text="+encodeURIComponent(pesan));
}

// ===== AUTO BARIS =====
window.onload = () => tambahBaris();
</script>

</body>
</html>
